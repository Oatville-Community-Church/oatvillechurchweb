# GitHub Pages Deployment Fixes

## Issues Fixed

### 1. Content Security Policy (CSP) Violations

**Problem**: Inline scripts generated by Vite's legacy plugin were being blocked by CSP directives.

**Error Messages**:

```text
Refused to execute inline script because it violates the following Content Security Policy directive: "script-src 'self' https://www.youtube.com https://www.youtube-nocookie.com". Either the 'unsafe-inline' keyword, a hash ('sha256-ZxAi3a7m9Mzbc+Z1LGuCCK5Xee6reDkEPRas66H9KSo='), or a nonce ('nonce-...') is required to enable inline execution.
```

**Solution**: Added specific SHA256 hashes to the CSP directive in `src/index.html`:

- `sha256-ZxAi3a7m9Mzbc+Z1LGuCCK5Xee6reDkEPRas66H9KSo=` (modern browser detection)
- `sha256-+5XkZFazzJo8n0iOP4ti/cLCMUudTf//Mzkb7xNPXIc=` (legacy polyfill loader)

### 2. Incorrect Base Path Configuration

**Problem**: Assets were being served from wrong paths, causing 404 errors.

**Error Messages**:

```text
GET https://oatville-community-church.github.io/oatvillechurch/assets/polyfills-BIojcvBQ.js net::ERR_ABORTED 404 (Not Found)
GET https://oatville-community-church.github.io/oatvillechurch/assets/main-CNYTPzs-.js net::ERR_ABORTED 404 (Not Found)
```

**Solution**:

- Updated `vite.config.js` to use correct repository name `oatvillechurchweb` instead of `oatvillechurch`
- Updated site URLs in `src/data/churchInformation.json`
- Updated GitHub Actions workflow in `.github/workflows/deploy.yml`

### 3. Build Script Configuration

**Problem**: Local builds weren't using the correct base path for GitHub Pages.

**Solution**:

- Added `cross-env` dependency for cross-platform environment variable support
- Added new `build:github` script that sets `GITHUB_PAGES=true` environment variable
- Updated GitHub Actions workflow to use correct site URL

## Files Modified

### Configuration Files

- `vite.config.js`: Updated repository name and site URLs
- `package.json`: Added `build:github` script and `cross-env` dependency
- `.github/workflows/deploy.yml`: Updated site URL

### Data Files

- `src/data/churchInformation.json`: Updated site URL

### HTML Templates

- `src/index.html`: Updated CSP directive with script hashes

## Build Commands

### For Local Development

```bash
npm run dev
```

### For GitHub Pages Deployment

```bash
npm run build:github
```

### Regular Build (without base path)

```bash
npm run build
```

## Deployment Process

The GitHub Actions workflow automatically:

1. Sets `GITHUB_PAGES=true` environment variable
2. Sets correct `SITE_URL`
3. Runs `npm run build` which detects GitHub Pages environment
4. Applies correct base path `/oatvillechurchweb/` to all assets
5. Generates manifest and service worker with correct paths
6. Deploys to GitHub Pages

## Testing

After deployment, verify:

- [ ] No CSP violations in browser console
- [ ] All assets load correctly (CSS, JS, images)
- [ ] PWA manifest loads correctly
- [ ] Service worker registers successfully
- [ ] No 404 errors for any resources

## URLs

- **Live Site**: <https://oatville-community-church.github.io/oatvillechurchweb/>
- **Repository**: <https://github.com/Oatville-Community-Church/oatvillechurchweb>
